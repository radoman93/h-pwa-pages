{"version":3,"file":"default-src_app_modals_edit-profile_edit-profile_page_ts.js","mappings":"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","sources":["./src/app/modals/edit-profile/edit-profile.page.ts","./src/app/service/user.service.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport {ModalController} from \"@ionic/angular\";\r\nimport {UserStore} from \"../../store/user.store\";\r\nimport * as Parse from 'parse';\r\nimport {IUser, IUserEdit, IUserRegisterAttributes} from \"../../model/user.model\";\r\nimport {SettingsStore} from \"../../store/settings.store\";\r\nimport {ICountry} from \"../../model/country.model\";\r\nimport {ICity} from \"../../model/city.model\";\r\nimport {IShop} from \"../../model/shop.model\";\r\nimport {PinpointHelper} from \"../../helper/pinpoint.helper\";\r\nimport {PasswordValidation} from \"../../validators/pw-validation\";\r\nimport {ParseHelper} from \"../../helper/parse.helper\";\r\nimport {UserService} from \"../../service/user.service\";\r\n\r\n\r\n@Component({\r\n  selector: 'app-edit-profile',\r\n  templateUrl: './edit-profile.page.html',\r\n  styleUrls: ['./edit-profile.page.scss'],\r\n})\r\nexport class EditProfilePage implements OnInit {\r\n  uploaded: boolean;\r\n  user: IUser;\r\n\r\n  countries: ICountry[];\r\n  cities: ICity[];\r\n  shops: IShop[];\r\n\r\n  selectedCountry: string;\r\n  selectedCity: string;\r\n  selectedShop: string;\r\n\r\n\r\n  constructor(private userService: UserService, private pinpointHelper: PinpointHelper, private modalController: ModalController, private settingsStore: SettingsStore) {\r\n    this.user = Parse.User.current().toJSON() as unknown as IUser;\r\n\r\n    this.selectedCountry = this.user.country.objectId;\r\n\r\n    this.countries = this.settingsStore.countries;\r\n    this.shops = this.settingsStore.shops;\r\n    console.log('Got user: ', this.settingsStore.countries);\r\n  }\r\n\r\n  ngOnInit() {\r\n    console.log('Current user: ', Parse.User.current().toJSON());\r\n  }\r\n\r\n\r\n  async closeModal() {\r\n    await this.modalController.dismiss();\r\n  }\r\n\r\n  onCountryChange(event: any){\r\n    console.log('Got event: ', event.detail.value);\r\n    this.cities = this.pinpointHelper.getCitiesFromCountry(event.detail.value);\r\n    this.selectedCity = null;\r\n    this.shops = [];\r\n  }\r\n\r\n  onCityChange(event: any){\r\n    console.log('Got event: ', event.detail.value);\r\n    this.shops = this.pinpointHelper.getShopsFromCity(event.detail.value);\r\n    this.selectedShop = null;\r\n\r\n  }\r\n\r\n  async finishEdit() {\r\n    try {\r\n      this.uploaded = false;\r\n      const country: Parse.Object = ParseHelper.getParseObjectWithoutData('Country', this.selectedCountry);\r\n      // const city: Parse.Object = ParseHelper.getParseObjectWithoutData('City', this.selectedCity);\r\n      const shopBrand: Parse.Object = ParseHelper.getParseObjectWithoutData('Shop', this.selectedShop);\r\n\r\n\r\n\r\n      const registerAttributes: IUserRegisterAttributes = {\r\n        firstName: this.user.firstName.trim(),\r\n        lastName: this.user.lastName.trim(),\r\n        email: this.user.email.toLowerCase().trim(),\r\n        country,\r\n        shopBrand,\r\n        city: this.user.city.trim(),\r\n        shop: this.user.shop.trim(),\r\n        phoneNumber: this.user.phoneNumber.trim(),\r\n      };\r\n      const editUser: IUserEdit = {\r\n        newUser: registerAttributes,\r\n        user: Parse.User.current()\r\n      };\r\n      await this.userService.editUserRequest(editUser);\r\n      const delay = ms => new Promise(res => setTimeout(res, ms));\r\n      await delay(1000);\r\n      this.uploaded = true;\r\n      await this.closeModal();\r\n    }catch (e) {\r\n      const delay = ms => new Promise(res => setTimeout(res, ms));\r\n      await delay(1000);\r\n      this.uploaded = true;\r\n      console.log('Error: ', e);\r\n    }\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport * as Parse from 'parse';\r\nimport {PaginationHelper} from '../helper/pagination.helper';\r\nimport {UserStore} from '../store/user.store';\r\nimport {Router} from \"@angular/router\";\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\n\r\nexport class UserService {\r\n  constructor(private paginationHelper: PaginationHelper, private userStore: UserStore, private router: Router) {\r\n  }\r\n\r\n  async anonymousLogin() {\r\n    try {\r\n      // await Parse.User.logInWith('anonymous', {authData: {\r\n      //     id: '1'\r\n      //   }});\r\n      const user = await Parse.AnonymousUtils.logIn();\r\n      console.log('User: ', user)\r\n    } catch (e) {\r\n      console.log('Error: ', e);\r\n    }\r\n  }\r\n\r\n  async login(username, password) {\r\n    try {\r\n      const user = await Parse.User.logIn(username, password);\r\n      // if (Parse.User.current().get('customer_token'))\r\n      return '';\r\n    } catch (e) {\r\n      console.log(e);\r\n      return 'Invalid email or password';\r\n    }\r\n  }\r\n\r\n  async register(email, password, attributes) {\r\n    try {\r\n      const user = await Parse.User.signUp(email, password, attributes);\r\n      return null;\r\n    } catch (e) {\r\n      console.log('Error:', e.message);\r\n      return e.message;\r\n    }\r\n  }\r\n\r\n  async logout() {\r\n    try {\r\n      await Parse.User.logOut();\r\n      await this.router.navigate(['/login']);\r\n    } catch (e) {\r\n      console.log('Error:', e);\r\n    }\r\n  }\r\n\r\n  // async changePoints(){\r\n  //   try {\r\n  //     await\r\n  //   }catch (e) {\r\n  //     console.log('Error: ', e);\r\n  //   }\r\n  // }\r\n\r\n  async editUserRequest(data: any) {\r\n    try {\r\n      const editTable = Parse.Object.extend('Edit_User_Request');\r\n      const edit = new editTable();\r\n      console.log('Saving request data');\r\n      await edit.save(data);\r\n      console.log('Request Data saved');\r\n    } catch (e) {\r\n      console.log('Error: ', e);\r\n    }\r\n  }\r\n\r\n  async updateUser(data: any) {\r\n    try {\r\n      await Parse.User.current().save(data);\r\n    } catch (e) {\r\n      console.log('Error', e);\r\n    }\r\n  }\r\n\r\n  async saveUser() {\r\n    try {\r\n      await Parse.User.current().save();\r\n    } catch (e) {\r\n      console.log('Error: ', e);\r\n    }\r\n  }\r\n\r\n  // async setUserCity(city: string) {\r\n  //     try {\r\n  //         await Parse.User.current().set('city', city);\r\n  //         await Parse.User.current().save();\r\n  //     } catch (e) {\r\n  //         console.log('Error: ', e);\r\n  //     }\r\n  // }\r\n\r\n  async resetPassword(email) {\r\n    try {\r\n      await Parse.User.requestPasswordReset(email);\r\n      return true;\r\n    } catch (e) {\r\n      console.log('Error:', e);\r\n      return false;\r\n    }\r\n  }\r\n\r\n\r\n}\r\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}